openapi: 3.0.3
info:
  title: Causa API
  version: 0.2.0
  description: API for issue tracking and phase workflows.
servers:
  - url: /
paths:
  /issues:
    post:
      tags:
        - Issues
      summary: Create a new issue
      operationId: createIssue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIssueRequest'
      responses:
        '201':
          description: Issue created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
    get:
      tags:
        - Issues
      summary: List issues
      operationId: listIssues
      parameters:
        - name: ownerId
          in: query
          required: false
          schema:
            type: string
        - name: assigneeId
          in: query
          required: false
          schema:
            type: string
        - name: memberId
          in: query
          required: false
          schema:
            type: string
        - name: projectId
          in: query
          required: false
          schema:
            type: string
        - name: status
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/IssueStatus'
        - name: phaseKind
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/PhaseKind'
      responses:
        '200':
          description: Issue list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IssueListItem'
  /issues/{issueId}:
    get:
      tags:
        - Issues
      summary: Get issue by id
      operationId: getIssue
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Issue details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue not found
    patch:
      tags:
        - Issues
      summary: Update issue metadata
      operationId: updateIssue
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIssueRequest'
      responses:
        '200':
          description: Issue updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue not found
  /issues/{issueId}/owner:
    patch:
      tags:
        - Issues
      summary: Assign issue owner
      operationId: assignIssueOwner
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignOwnerRequest'
      responses:
        '200':
          description: Owner assigned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue not found
  /issues/{issueId}/actions/close:
    post:
      tags:
        - Issues
      summary: Close an issue
      operationId: closeIssue
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Issue closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '409':
          description: Issue not ready to close
  /issues/{issueId}/phases:
    post:
      tags:
        - Issues
      summary: Add a phase to an issue
      operationId: addPhase
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPhaseRequest'
      responses:
        '200':
          description: Phase added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue not found
  /issues/{issueId}/phases/{phaseId}:
    patch:
      tags:
        - Issues
      summary: Update phase
      operationId: updatePhase
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePhaseRequest'
      responses:
        '200':
          description: Phase updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue or phase not found
  /issues/{issueId}/phases/{phaseId}/assignee:
    patch:
      tags:
        - Issues
      summary: Assign a phase assignee
      operationId: assignPhaseAssignee
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignAssigneeRequest'
      responses:
        '200':
          description: Assignee updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue or phase not found
  /issues/{issueId}/phases/{phaseId}/actions/fail:
    post:
      tags:
        - Issues
      summary: Mark phase as failed
      operationId: failPhase
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Phase failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '409':
          description: Invalid transition
  /issues/{issueId}/phases/{phaseId}/actions/reopen:
    post:
      tags:
        - Issues
      summary: Reopen phase
      operationId: reopenPhase
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Phase reopened
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '409':
          description: Invalid transition
  /issues/{issueId}/phases/{phaseId}/tasks:
    post:
      tags:
        - Issues
      summary: Add a task to a phase
      operationId: addTask
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddTaskRequest'
      responses:
        '200':
          description: Task added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue or phase not found
  /issues/{issueId}/phases/{phaseId}/tasks/{taskId}:
    patch:
      tags:
        - Issues
      summary: Update task
      operationId: updateTask
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
        - name: phaseId
          in: path
          required: true
          schema:
            type: string
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
      responses:
        '200':
          description: Task updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueDetail'
        '404':
          description: Issue, phase, or task not found
  /issues/{issueId}/history:
    get:
      tags:
        - Issues
      summary: Get issue history
      operationId: getIssueHistory
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Issue history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueHistoryResponse'
        '404':
          description: Issue not found
  /issues/{issueId}/comments:
    get:
      tags:
        - Issues
      summary: List issue comments
      operationId: listIssueComments
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Comment list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CommentResponse'
    post:
      tags:
        - Issues
      summary: Add issue comment
      operationId: addIssueComment
      parameters:
        - name: issueId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentRequest'
      responses:
        '201':
          description: Comment added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
  /me/work:
    get:
      tags:
        - Work
      summary: Get per-user work queues
      operationId: getMyWork
      responses:
        '200':
          description: Work queues
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MyWorkResponse'
  /auth/methods:
    get:
      tags:
        - Auth
      summary: List available authentication methods
      operationId: getAuthMethods
      responses:
        '200':
          description: Auth methods
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthMethodsResponse'
  /search:
    get:
      tags:
        - Search
      summary: Search issues
      operationId: searchIssues
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: projectId
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IssueListItem'
components:
  schemas:
    CreateIssueRequest:
      type: object
      required:
        - title
        - ownerId
        - projectId
        - phases
      properties:
        title:
          type: string
        ownerId:
          type: string
        projectId:
          type: string
        phases:
          type: array
          items:
            $ref: '#/components/schemas/CreatePhaseRequest'
    UpdateIssueRequest:
      type: object
      properties:
        title:
          type: string
        ownerId:
          type: string
        projectId:
          type: string
    AssignOwnerRequest:
      type: object
      required:
        - ownerId
      properties:
        ownerId:
          type: string
    AssignAssigneeRequest:
      type: object
      required:
        - assigneeId
      properties:
        assigneeId:
          type: string
    AddPhaseRequest:
      type: object
      required:
        - name
        - assigneeId
      properties:
        name:
          type: string
        assigneeId:
          type: string
        kind:
          $ref: '#/components/schemas/PhaseKind'
    UpdatePhaseRequest:
      type: object
      properties:
        name:
          type: string
        assigneeId:
          type: string
        status:
          $ref: '#/components/schemas/PhaseStatus'
        kind:
          $ref: '#/components/schemas/PhaseKind'
    AddTaskRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        assigneeId:
          type: string
    UpdateTaskRequest:
      type: object
      properties:
        title:
          type: string
        assigneeId:
          type: string
        status:
          $ref: '#/components/schemas/TaskStatus'
    CreatePhaseRequest:
      type: object
      required:
        - name
        - assigneeId
      properties:
        name:
          type: string
        assigneeId:
          type: string
        kind:
          $ref: '#/components/schemas/PhaseKind'
    IssueListItem:
      type: object
      required:
        - id
        - title
        - ownerId
        - phaseCount
        - status
      properties:
        id:
          type: string
        title:
          type: string
        ownerId:
          type: string
        projectId:
          type: string
        phaseCount:
          type: integer
          format: int32
        status:
          $ref: '#/components/schemas/IssueStatus'
    IssueDetail:
      type: object
      required:
        - id
        - title
        - ownerId
        - phases
        - status
        - version
      properties:
        id:
          type: string
        title:
          type: string
        ownerId:
          type: string
        projectId:
          type: string
        phases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseResponse'
        status:
          $ref: '#/components/schemas/IssueStatus'
        version:
          type: integer
          format: int64
        allowedActions:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ActionDecision'
    PhaseResponse:
      type: object
      required:
        - id
        - name
        - assigneeId
        - status
        - tasks
      properties:
        id:
          type: string
        name:
          type: string
        assigneeId:
          type: string
        status:
          $ref: '#/components/schemas/PhaseStatus'
        kind:
          $ref: '#/components/schemas/PhaseKind'
        tasks:
          type: array
          items:
            $ref: '#/components/schemas/TaskResponse'
        allowedActions:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ActionDecision'
    TaskResponse:
      type: object
      required:
        - id
        - title
        - status
      properties:
        id:
          type: string
        title:
          type: string
        assigneeId:
          type: string
        status:
          $ref: '#/components/schemas/TaskStatus'
        allowedActions:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ActionDecision'
    IssueHistoryResponse:
      type: object
      required:
        - activity
        - audit
      properties:
        activity:
          type: array
          items:
            $ref: '#/components/schemas/ActivityEntry'
        audit:
          type: array
          items:
            $ref: '#/components/schemas/AuditEntry'
    ActivityEntry:
      type: object
      required:
        - id
        - issueId
        - type
        - summary
        - occurredAt
      properties:
        id:
          type: string
        issueId:
          type: string
        type:
          type: string
        summary:
          type: string
        actorId:
          type: string
        occurredAt:
          type: string
          format: date-time
    AuditEntry:
      type: object
      required:
        - id
        - issueId
        - entityType
        - entityId
        - changeType
        - occurredAt
      properties:
        id:
          type: string
        issueId:
          type: string
        entityType:
          type: string
        entityId:
          type: string
        changeType:
          type: string
        actorId:
          type: string
        occurredAt:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
    AddCommentRequest:
      type: object
      required:
        - body
      properties:
        body:
          type: string
        mentions:
          type: array
          items:
            type: string
    CommentResponse:
      type: object
      required:
        - id
        - issueId
        - authorId
        - body
        - createdAt
      properties:
        id:
          type: string
        issueId:
          type: string
        authorId:
          type: string
        body:
          type: string
        createdAt:
          type: string
          format: date-time
    MyWorkResponse:
      type: object
      required:
        - ownedIssues
        - assignedPhases
        - assignedTasks
      properties:
        ownedIssues:
          type: array
          items:
            $ref: '#/components/schemas/IssueListItem'
        assignedPhases:
          type: array
          items:
            $ref: '#/components/schemas/PhaseWorkItem'
        assignedTasks:
          type: array
          items:
            $ref: '#/components/schemas/TaskWorkItem'
    AuthMethodsResponse:
      type: object
      required:
        - methods
      properties:
        methods:
          type: array
          items:
            $ref: '#/components/schemas/AuthMethod'
    AuthMethod:
      type: object
      required:
        - type
        - label
      properties:
        type:
          type: string
        label:
          type: string
        authorizeUrl:
          type: string
    PhaseWorkItem:
      type: object
      required:
        - issueId
        - phaseId
        - phaseName
        - status
      properties:
        issueId:
          type: string
        phaseId:
          type: string
        phaseName:
          type: string
        status:
          $ref: '#/components/schemas/PhaseStatus'
    TaskWorkItem:
      type: object
      required:
        - issueId
        - phaseId
        - taskId
        - taskTitle
        - status
      properties:
        issueId:
          type: string
        phaseId:
          type: string
        taskId:
          type: string
        taskTitle:
          type: string
        status:
          $ref: '#/components/schemas/TaskStatus'
    ActionDecision:
      type: object
      required:
        - allowed
      properties:
        allowed:
          type: boolean
        reason:
          type: string
    IssueStatus:
      type: string
      enum:
        - CREATED
        - IN_ANALYSIS
        - IN_DEVELOPMENT
        - IN_TEST
        - IN_ROLLOUT
        - DONE
        - FAILED
    PhaseStatus:
      type: string
      enum:
        - NOT_STARTED
        - IN_PROGRESS
        - DONE
        - FAILED
    TaskStatus:
      type: string
      enum:
        - NOT_STARTED
        - IN_PROGRESS
        - DONE
    PhaseKind:
      type: string
      enum:
        - INVESTIGATION
        - PROPOSE_SOLUTION
        - DEVELOPMENT
        - ACCEPTANCE_TEST
        - ROLLOUT
